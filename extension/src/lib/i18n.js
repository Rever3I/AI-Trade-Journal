const zh_CN = {
  // Onboarding
  'onboarding.welcome.title': 'AI Trade Journal',
  'onboarding.welcome.subtitle': '一键捕获交易记录，AI自动生成专业复盘分析，同步到Notion',
  'onboarding.welcome.start': '开始设置',
  'onboarding.license.title': '输入激活码',
  'onboarding.license.placeholder': 'XXXX-XXXX-XXXX-XXXX',
  'onboarding.license.activate': '激活',
  'onboarding.license.activating': '激活中...',
  'onboarding.notion.title': '连接Notion',
  'onboarding.notion.desc': '授权后，我们可以将交易记录同步到你的Notion工作区',
  'onboarding.notion.connect': '连接Notion账号',
  'onboarding.notion.connecting': '连接中...',
  'onboarding.notion.connected': '已连接',
  'onboarding.database.title': '创建交易日志',
  'onboarding.database.desc': '在你的Notion中自动创建交易日志数据库',
  'onboarding.database.create': '创建数据库',
  'onboarding.database.creating': '创建中...',
  'onboarding.database.viewInNotion': '在Notion中查看',
  'onboarding.done.title': '设置完成！',
  'onboarding.done.desc': '现在可以开始使用AI Trade Journal了',
  'onboarding.done.start': '开始使用',
  'onboarding.back': '返回',
  'onboarding.step': '步骤 {current}/{total}',

  // Tabs
  'tab.smartPaste': '智能粘贴',
  'tab.history': '历史记录',
  'tab.analysis': 'AI分析',
  'tab.settings': '设置',

  // Smart Paste
  'smartPaste.title': '智能粘贴',
  'smartPaste.placeholder': '粘贴交易记录...\n\n支持格式：\n• 富途CSV导出\n• IBKR Flex Query\n• Webull导出\n• 嘉信CSV\n• 自由文本（如：买入100股NVDA@135.50）',
  'smartPaste.parse': '解析交易',
  'smartPaste.parsing': '正在解析...',
  'smartPaste.clear': '清空',
  'smartPaste.charCount': '{count} 字符 / {lines} 行',
  'smartPaste.preview.title': '解析结果',
  'smartPaste.preview.tradeCount': '共 {count} 笔交易',
  'smartPaste.preview.skippedRows': '（跳过 {count} 行）',
  'smartPaste.preview.symbolPlaceholder': '股票代码',
  'smartPaste.preview.qtyPlaceholder': '数量',
  'smartPaste.preview.pricePlaceholder': '价格',
  'smartPaste.preview.option': '期权',
  'smartPaste.preview.confidence': '置信度',
  'smartPaste.preview.edit': '编辑',
  'smartPaste.preview.save': '保存',
  'smartPaste.preview.cancel': '取消',
  'smartPaste.sync': '同步到Notion',
  'smartPaste.syncing': '同步中... {current}/{total}',
  'smartPaste.syncSuccess': '同步成功！',
  'smartPaste.viewInNotion': '在Notion中查看 →',
  'smartPaste.empty.title': '粘贴交易记录开始',
  'smartPaste.empty.example': '示例：从券商导出CSV，或直接输入\n买入 100 NVDA 135.50\n卖出 100 NVDA 142.30',

  // Analysis
  'analysis.title': 'AI分析',
  'analysis.selectTemplate': '选择分析模板',
  'analysis.templates.daily_review': '日内复盘',
  'analysis.templates.single_trade': '单笔深挖',
  'analysis.templates.weekly_stats': '周度统计',
  'analysis.templates.strategy_eval': '策略评估',
  'analysis.templates.emotion_check': '情绪体检',
  'analysis.templates.risk_assessment': '风险体检',
  'analysis.analyze': '开始分析',
  'analysis.analyzing': '分析中...',
  'analysis.reanalyze': '重新分析',
  'analysis.saveToNotion': '保存到Notion',
  'analysis.saving': '保存中...',
  'analysis.saved': '已保存',
  'analysis.score': '综合评分',
  'analysis.metrics': '关键指标',
  'analysis.metrics.winRate': '胜率',
  'analysis.metrics.rMultiple': 'R倍数',
  'analysis.metrics.profitFactor': '盈利因子',
  'analysis.metrics.totalTrades': '总交易',
  'analysis.metrics.totalPnl': '总盈亏',
  'analysis.metrics.avgHoldTime': '平均持仓',
  'analysis.category.execution': '执行',
  'analysis.category.risk': '风控',
  'analysis.category.pattern': '模式',
  'analysis.category.emotion': '情绪',
  'analysis.category.improvement': '改进',
  'analysis.insights': '分析洞察',
  'analysis.actionItems': '改进建议',
  'analysis.summary': '一句话总结',
  'analysis.noTrades': '请先在"智能粘贴"中解析交易数据',

  // History
  'history.title': '历史记录',
  'history.empty': '暂无同步记录',
  'history.trades': '{count} 笔交易',
  'history.status.synced': '已同步',
  'history.status.pending': '待同步',
  'history.status.error': '同步失败',
  'history.score': '评分: {score}',

  // Settings
  'settings.title': '设置',
  'settings.notion.title': 'Notion连接',
  'settings.notion.connected': '已连接',
  'settings.notion.disconnected': '未连接',
  'settings.notion.connect': '连接Notion',
  'settings.notion.disconnect': '断开连接',
  'settings.notion.database': '交易日志数据库',
  'settings.notion.setupDb': '创建数据库',
  'settings.license.title': '许可证',
  'settings.license.active': '已激活',
  'settings.license.inactive': '未激活',
  'settings.license.key': '激活码',
  'settings.license.activate': '激活',
  'settings.license.usage': '今日已用 {used}/{limit} 次分析',
  'settings.language.title': '语言',
  'settings.about.title': '关于',
  'settings.about.version': '版本 {version}',

  // Errors
  'error.network': '网络超时，请检查网络连接后重试',
  'error.rateLimit': '今日免费分析已用完（{used}/{limit}），明天重置',
  'error.notionDisconnected': 'Notion连接已断开，请重新连接',
  'error.invalidLicense': '激活码无效，请检查后重试',
  'error.licenseUsed': '该激活码已被使用',
  'error.parseFailed': '无法识别交易数据格式，请检查粘贴的内容',
  'error.parseFailedLink': '查看支持的格式',
  'error.syncFailed': '同步失败，请重试',
  'error.analysisFailed': 'AI分析失败，请重试',
  'error.databaseSetup': '数据库创建失败，请重试',
  'error.unknown': '发生未知错误，请重试',
  'error.retry': '重试',

  // Common
  'common.loading': '加载中...',
  'common.confirm': '确认',
  'common.cancel': '取消',
  'common.save': '保存',
  'common.delete': '删除',
  'common.close': '关闭',
  'common.success': '成功',
  'common.failed': '失败',
};

const en = {
  'onboarding.welcome.title': 'AI Trade Journal',
  'onboarding.welcome.subtitle': 'One-click trade capture with AI-powered analysis, synced to Notion',
  'onboarding.welcome.start': 'Get Started',
  'onboarding.license.title': 'Enter License Key',
  'onboarding.license.placeholder': 'XXXX-XXXX-XXXX-XXXX',
  'onboarding.license.activate': 'Activate',
  'onboarding.license.activating': 'Activating...',
  'onboarding.notion.title': 'Connect Notion',
  'onboarding.notion.desc': 'Authorize to sync trade records to your Notion workspace',
  'onboarding.notion.connect': 'Connect Notion',
  'onboarding.notion.connecting': 'Connecting...',
  'onboarding.notion.connected': 'Connected',
  'onboarding.database.title': 'Create Trading Journal',
  'onboarding.database.desc': 'Auto-create a trading journal database in your Notion',
  'onboarding.database.create': 'Create Database',
  'onboarding.database.creating': 'Creating...',
  'onboarding.database.viewInNotion': 'View in Notion',
  'onboarding.done.title': 'All Set!',
  'onboarding.done.desc': 'You\'re ready to use AI Trade Journal',
  'onboarding.done.start': 'Start Using',
  'onboarding.back': 'Back',
  'onboarding.step': 'Step {current}/{total}',
  'tab.smartPaste': 'Smart Paste',
  'tab.history': 'History',
  'tab.analysis': 'Analysis',
  'tab.settings': 'Settings',
  'smartPaste.title': 'Smart Paste',
  'smartPaste.placeholder': 'Paste trade records...\n\nSupported formats:\n• Futu CSV export\n• IBKR Flex Query\n• Webull export\n• Schwab CSV\n• Free text (e.g., bought 100 NVDA @135.50)',
  'smartPaste.parse': 'Parse Trades',
  'smartPaste.parsing': 'Parsing...',
  'smartPaste.clear': 'Clear',
  'smartPaste.charCount': '{count} chars / {lines} lines',
  'smartPaste.preview.title': 'Parse Results',
  'smartPaste.preview.tradeCount': '{count} trades found',
  'smartPaste.preview.skippedRows': '({count} rows skipped)',
  'smartPaste.preview.symbolPlaceholder': 'Symbol',
  'smartPaste.preview.qtyPlaceholder': 'Qty',
  'smartPaste.preview.pricePlaceholder': 'Price',
  'smartPaste.preview.option': 'OPT',
  'smartPaste.preview.confidence': 'Confidence',
  'smartPaste.preview.edit': 'Edit',
  'smartPaste.preview.save': 'Save',
  'smartPaste.preview.cancel': 'Cancel',
  'smartPaste.sync': 'Sync to Notion',
  'smartPaste.syncing': 'Syncing... {current}/{total}',
  'smartPaste.syncSuccess': 'Sync complete!',
  'smartPaste.viewInNotion': 'View in Notion →',
  'smartPaste.empty.title': 'Paste trade records to begin',
  'smartPaste.empty.example': 'Example: export CSV from broker, or type\nbought 100 NVDA 135.50\nsold 100 NVDA 142.30',
  'analysis.title': 'Analysis',
  'analysis.selectTemplate': 'Select analysis template',
  'analysis.templates.daily_review': 'Daily Review',
  'analysis.templates.single_trade': 'Single Trade Deep-Dive',
  'analysis.templates.weekly_stats': 'Weekly Stats',
  'analysis.templates.strategy_eval': 'Strategy Evaluation',
  'analysis.templates.emotion_check': 'Emotion Check',
  'analysis.templates.risk_assessment': 'Risk Assessment',
  'analysis.analyze': 'Analyze',
  'analysis.analyzing': 'Analyzing...',
  'analysis.reanalyze': 'Re-analyze',
  'analysis.saveToNotion': 'Save to Notion',
  'analysis.saving': 'Saving...',
  'analysis.saved': 'Saved',
  'analysis.score': 'Overall Score',
  'analysis.metrics': 'Key Metrics',
  'analysis.metrics.winRate': 'Win Rate',
  'analysis.metrics.rMultiple': 'R-Multiple',
  'analysis.metrics.profitFactor': 'Profit Factor',
  'analysis.metrics.totalTrades': 'Total Trades',
  'analysis.metrics.totalPnl': 'Total P/L',
  'analysis.metrics.avgHoldTime': 'Avg Hold',
  'analysis.category.execution': 'Execution',
  'analysis.category.risk': 'Risk',
  'analysis.category.pattern': 'Pattern',
  'analysis.category.emotion': 'Emotion',
  'analysis.category.improvement': 'Improve',
  'analysis.insights': 'Insights',
  'analysis.actionItems': 'Action Items',
  'analysis.summary': 'Summary',
  'analysis.noTrades': 'Parse trades in Smart Paste first',
  'history.title': 'History',
  'history.empty': 'No sync records yet',
  'history.trades': '{count} trades',
  'history.status.synced': 'Synced',
  'history.status.pending': 'Pending',
  'history.status.error': 'Failed',
  'history.score': 'Score: {score}',
  'settings.title': 'Settings',
  'settings.notion.title': 'Notion Connection',
  'settings.notion.connected': 'Connected',
  'settings.notion.disconnected': 'Not Connected',
  'settings.notion.connect': 'Connect Notion',
  'settings.notion.disconnect': 'Disconnect',
  'settings.notion.database': 'Trading Journal DB',
  'settings.notion.setupDb': 'Create Database',
  'settings.license.title': 'License',
  'settings.license.active': 'Active',
  'settings.license.inactive': 'Inactive',
  'settings.license.key': 'License Key',
  'settings.license.activate': 'Activate',
  'settings.license.usage': 'Used {used}/{limit} analyses today',
  'settings.language.title': 'Language',
  'settings.about.title': 'About',
  'settings.about.version': 'Version {version}',
  'error.network': 'Network timeout. Please check connection and retry.',
  'error.rateLimit': 'Daily free analyses used up ({used}/{limit}). Resets tomorrow.',
  'error.notionDisconnected': 'Notion disconnected. Please reconnect.',
  'error.invalidLicense': 'Invalid license key. Please check and retry.',
  'error.licenseUsed': 'This license key has already been used.',
  'error.parseFailed': 'Could not recognize trade data format. Please check pasted content.',
  'error.parseFailedLink': 'View supported formats',
  'error.syncFailed': 'Sync failed. Please retry.',
  'error.analysisFailed': 'Analysis failed. Please retry.',
  'error.databaseSetup': 'Database creation failed. Please retry.',
  'error.unknown': 'Unknown error occurred. Please retry.',
  'error.retry': 'Retry',
  'common.loading': 'Loading...',
  'common.confirm': 'Confirm',
  'common.cancel': 'Cancel',
  'common.save': 'Save',
  'common.delete': 'Delete',
  'common.close': 'Close',
  'common.success': 'Success',
  'common.failed': 'Failed',
};

const locales = { zh_CN, en };

let currentLocale = 'zh_CN';

export function setLocale(locale) {
  if (locales[locale]) {
    currentLocale = locale;
  }
}

export function getLocale() {
  return currentLocale;
}

export function t(key, params = {}) {
  const strings = locales[currentLocale] || locales.zh_CN;
  let str = strings[key] || locales.zh_CN[key] || key;
  for (const [param, value] of Object.entries(params)) {
    str = str.replace(new RegExp(`\\{${param}\\}`, 'g'), String(value));
  }
  return str;
}

export async function initLocale() {
  try {
    if (typeof chrome !== 'undefined' && chrome.storage && chrome.storage.local) {
      const result = await chrome.storage.local.get('locale');
      const stored = result && result.locale;
      if (stored && locales[stored]) {
        currentLocale = stored;
      }
    }
  } catch {
    // Default to zh_CN
  }
}
